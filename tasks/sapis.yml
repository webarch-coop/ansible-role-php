---
- name: PHP SAPI modules enabled / disabled tasks included
  block:

    - name: "Include module enable / disable tasks for PHP {{ version }}"
      ansible.builtin.include_tasks: modules.yml
      loop: "{{ php_versions[version].sapis | dict2items }}"
      loop_control:
        loop_var: sapi
        label: "{{ sapi.key }}"
      when:
        - ( sapi.value.state is defined ) and ( sapi.value.state == "present" )
        - ( ansible_local.phpquery.versions[version].sapis[sapi.key].mods_enabled is defined ) and ( sapi.value.modules_enabled is defined )
        - ( ansible_local.phpquery.versions[version].sapis[sapi.key].mods_enabled | sort ) != ( sapi.value.modules_enabled | sort )

  tags:
    - php
...
