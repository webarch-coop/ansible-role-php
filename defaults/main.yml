# Copyright 2019-2023 Chris Croome
#
# This file is part of the Webarchitects PHP Ansible role.
#
# The Webarchitects PHP Ansible role is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
#
# The Webarchitects PHP Ansible role is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with the Webarchitects PHP Ansible role. If not, see <https://www.gnu.org/licenses/>.
---
php: true
php_alternatives: true
php_alternatives_update:
  - name: php
    link: /usr/bin/php
    slaves:
      - name: php.1.gz
        path: /usr/share/man/man1/php.1.gz
    status: manual
    best: /usr/bin/php8.1
    value: /usr/bin/php8.1
    alternatives:
      # - alternative: /usr/bin/php7.0
      #   priority: 70
      #   slaves:
      #     - name: php.1.gz
      #       path: /usr/share/man/man1/php7.0.1.gz
      # - alternative: /usr/bin/php7.3
      #   priority: 73
      #   slaves:
      #     - name: php.1.gz
      #       path: /usr/share/man/man1/php7.3.1.gz
      - alternative: /usr/bin/php7.4
        priority: 74
        slaves:
          - name: php.1.gz
            path: /usr/share/man/man1/php7.4.1.gz
      - alternative: /usr/bin/php8.0
        priority: 80
        slaves:
          - name: php.1.gz
            path: /usr/share/man/man1/php8.0.1.gz
      - alternative: /usr/bin/php8.1
        priority: 181
        slaves:
          - name: php.1.gz
            path: /usr/share/man/man1/php8.1.1.gz
      - alternative: /usr/bin/php8.2
        priority: 82
        slaves:
          - name: php.1.gz
            path: /usr/share/man/man1/php8.2.1.gz
php_check_legacy_variables: true
php_config:
  - name: PHP 8.2 configuration
    version: "8.2"
    state: present
    files:
      - name: PHP 8.2 FPM configuration
        path: /etc/php/8.2/fpm/php.ini
        state: edited
        conf:
          apc:
            "apc.enabled": "1"
            "apc.shm_size": "32M"
          Date:
            "date.timezone": "Europe/London"
          MySQLi:
            "mysqli.allow_local_infile": "Off"
          opcache:
            "opcache.enable": "1"
            "opcache.interned_strings_buffer": "32"
            "opcache.max_accelerated_files": "100000"
            "opcache.memory_consumption": "1024"
            "opcache.revalidate_freq": "2"
            "opcache.use_cwd": "1"
            "opcache.validate_permission": "1"
            "opcache.validate_root": "1"
            "opcache.validate_timestamps": "1"
          PHP:
            allow_url_include: "Off"
            default_socket_timeout: "600"
            disable_functions: "chgrp,chown,dl,exec,passthru,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,pcntl_unshare,popen,posix_kill,posix_mkfifo,posix_setpgid,posix_setsid,posix_setuid,show_source,socket_create,symlink,system,system_exec"
            max_file_uploads: "60"
            max_execution_time: "600"
            max_input_nesting_level: "512"
            max_input_time: "600"
            max_input_vars: "100000"
            memory_limit: "512M"
            output_buffering: "4096"
            post_max_size: "512M"
            short_open_tag: "Off"
            upload_max_filesize: "512M"
          Session:
            "session.save_path": "${TMPDIR}"
      - name: PHP 8.2 FPM www pool configuration
        path: /etc/php/8.2/fpm/pool.d/www.conf
        state: edited
        conf:
          www:
            pm: dynamic
            "pm.max_children": "4"
            "pm.max_requests": "1000"
            "pm.max_spare_servers": "1"
            "pm.min_spare_servers": "1"
            "pm.process_idle_timeout": "10s"
            "pm.start_servers": "1"
  - name: PHP 8.1 configuration
    version: "8.1"
    state: present
    files:
      - name: PHP 8.1 FPM configuration
        path: /etc/php/8.1/fpm/php.ini
        state: edited
        conf:
          apc:
            "apc.enabled": "1"
            "apc.shm_size": "32M"
          Date:
            "date.timezone": "Europe/London"
          MySQLi:
            "mysqli.allow_local_infile": "Off"
          opcache:
            "opcache.enable": "1"
            "opcache.interned_strings_buffer": "32"
            "opcache.max_accelerated_files": "100000"
            "opcache.memory_consumption": "1024"
            "opcache.revalidate_freq": "2"
            "opcache.use_cwd": "1"
            "opcache.validate_permission": "1"
            "opcache.validate_root": "1"
            "opcache.validate_timestamps": "1"
          PHP:
            allow_url_include: "Off"
            default_socket_timeout: "600"
            disable_functions: "chgrp,chown,dl,exec,passthru,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,pcntl_unshare,popen,posix_kill,posix_mkfifo,posix_setpgid,posix_setsid,posix_setuid,show_source,socket_create,symlink,system,system_exec"
            max_file_uploads: "60"
            max_execution_time: "600"
            max_input_nesting_level: "512"
            max_input_time: "600"
            max_input_vars: "100000"
            memory_limit: "512M"
            output_buffering: "4096"
            post_max_size: "512M"
            short_open_tag: "Off"
            upload_max_filesize: "512M"
          Session:
            "session.save_path": "${TMPDIR}"
      - name: PHP 8.1 FPM www pool configuration
        path: /etc/php/8.1/fpm/pool.d/www.conf
        state: edited
        conf:
          www:
            pm: dynamic
            "pm.max_children": "4"
            "pm.max_requests": "1000"
            "pm.max_spare_servers": "1"
            "pm.min_spare_servers": "1"
            "pm.process_idle_timeout": "10s"
            "pm.start_servers": "1"
  - name: PHP 8.0 configuration
    version: "8.0"
    state: present
    files:
      - name: PHP 8.0 FPM configuration
        path: /etc/php/8.0/fpm/php.ini
        state: edited
        conf:
          apc:
            "apc.enabled": "1"
            "apc.shm_size": "32M"
          Date:
            "date.timezone": "Europe/London"
          MySQLi:
            "mysqli.allow_local_infile": "Off"
          opcache:
            "opcache.enable": "1"
            "opcache.interned_strings_buffer": "32"
            "opcache.max_accelerated_files": "100000"
            "opcache.memory_consumption": "1024"
            "opcache.revalidate_freq": "2"
            "opcache.use_cwd": "1"
            "opcache.validate_permission": "1"
            "opcache.validate_root": "1"
            "opcache.validate_timestamps": "1"
          PHP:
            allow_url_include: "Off"
            default_socket_timeout: "600"
            disable_functions: "chgrp,chown,dl,exec,passthru,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,pcntl_unshare,popen,posix_kill,posix_mkfifo,posix_setpgid,posix_setsid,posix_setuid,show_source,socket_create,symlink,system,system_exec"
            max_file_uploads: "60"
            max_execution_time: "600"
            max_input_nesting_level: "512"
            max_input_time: "600"
            max_input_vars: "100000"
            memory_limit: "512M"
            output_buffering: "4096"
            post_max_size: "512M"
            short_open_tag: "Off"
            upload_max_filesize: "512M"
          Session:
            "session.save_path": "${TMPDIR}"
      - name: PHP 8.0 FPM www pool configuration
        path: /etc/php/8.0/fpm/pool.d/www.conf
        state: edited
        conf:
          www:
            pm: dynamic
            "pm.max_children": "4"
            "pm.max_requests": "1000"
            "pm.max_spare_servers": "1"
            "pm.min_spare_servers": "1"
            "pm.process_idle_timeout": "10s"
            "pm.start_servers": "1"
  - name: PHP 7.4 configuration
    version: "7.4"
    state: present
    files:
      - name: PHP 7.4 FPM configuration
        path: /etc/php/7.4/fpm/php.ini
        state: edited
        conf:
          apc:
            "apc.enabled": "1"
            "apc.shm_size": "32M"
          Date:
            "date.timezone": "Europe/London"
          MySQLi:
            "mysqli.allow_local_infile": "Off"
          opcache:
            "opcache.enable": "1"
            "opcache.interned_strings_buffer": "32"
            "opcache.max_accelerated_files": "100000"
            "opcache.memory_consumption": "1024"
            "opcache.revalidate_freq": "2"
            "opcache.use_cwd": "1"
            "opcache.validate_permission": "1"
            "opcache.validate_root": "1"
            "opcache.validate_timestamps": "1"
          PHP:
            allow_url_include: "Off"
            default_socket_timeout: "600"
            disable_functions: "chgrp,chown,dl,exec,passthru,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,pcntl_unshare,popen,posix_kill,posix_mkfifo,posix_setpgid,posix_setsid,posix_setuid,show_source,socket_create,symlink,system,system_exec"
            max_file_uploads: "60"
            max_execution_time: "600"
            max_input_nesting_level: "512"
            max_input_time: "600"
            max_input_vars: "100000"
            memory_limit: "512M"
            output_buffering: "4096"
            post_max_size: "512M"
            short_open_tag: "Off"
            upload_max_filesize: "512M"
          Session:
            "session.save_path": "${TMPDIR}"
      - name: PHP 7.4 FPM www pool configuration
        path: /etc/php/7.4/fpm/pool.d/www.conf
        state: edited
        conf:
          www:
            pm: dynamic
            "pm.max_children": "4"
            "pm.max_requests": "1000"
            "pm.max_spare_servers": "1"
            "pm.min_spare_servers": "1"
            "pm.process_idle_timeout": "10s"
            "pm.start_servers": "1"
  # - name: PHP 7.3 configuration
  #   version: "7.3"
  #   state: present
  #   files:
  #     - name: PHP 7.3 FPM configuration
  #       path: /etc/php/7.3/fpm/php.ini
  #       state: edited
  #       conf:
  #         PHP:
  #           max_input_time: "600"
  #           memory_limit: "512M"
  # - name: PHP 7.0 configuration
  #   version: "7.0"
  #   state: present
  #   files:
  #     - name: PHP 7.0 FPM configuration
  #       path: /etc/php/7.0/fpm/php.ini
  #       state: edited
  #       conf:
  #         PHP:
  #           max_input_time: "600"
  #           memory_limit: "512M"
php_sury: true
php_versions:
  - name: PHP 8.2 packages
    version: "8.2"
    state: present
    pkg_absent:
      - libapache2-mod-php8.2
      - php8.2-phpdbg
    pkg_present:
      - php8.2-apcu
      - php8.2-bcmath
      - php8.2-bz2
      - php8.2-cli
      - php8.2-common
      - php8.2-curl
      - php8.2-gd
      - php8.2-gmp
      - php8.2-fpm
      - php8.2-imagick
      - php8.2-imap
      - php8.2-intl
      - php8.2-ldap
      - php8.2-mbstring
      - php8.2-mysql
      - php8.2-opcache
      - php8.2-readline
      - php8.2-sqlite3
      - php8.2-soap
      - php8.2-uploadprogress
      - php8.2-xml
      - php8.2-xmlrpc
      - php8.2-xsl
      - php8.2-zip
      - php-pear
  - name: PHP 8.1 packages
    version: "8.1"
    state: present
    pkg_absent:
      - libapache2-mod-php8.1
      - php8.1-phpdbg
    pkg_present:
      - php8.1-apcu
      - php8.1-bcmath
      - php8.1-bz2
      - php8.1-cli
      - php8.1-common
      - php8.1-curl
      - php8.1-gd
      - php8.1-gmp
      - php8.1-fpm
      - php8.1-imagick
      - php8.1-imap
      - php8.1-intl
      - php8.1-ldap
      - php8.1-mbstring
      - php8.1-mysql
      - php8.1-opcache
      - php8.1-readline
      - php8.1-sqlite3
      - php8.1-soap
      - php8.1-uploadprogress
      - php8.1-xml
      - php8.1-xmlrpc
      - php8.1-xsl
      - php8.1-zip
      - php-pear
  - name: PHP 8.0 packages
    version: "8.0"
    state: present
    pkg_absent:
      - libapache2-mod-php8.0
      - php8.0-phpdbg
    pkg_present:
      - php8.0-apcu
      - php8.0-bcmath
      - php8.0-bz2
      - php8.0-cli
      - php8.0-common
      - php8.0-curl
      - php8.0-gd
      - php8.0-gmp
      - php8.0-fpm
      - php8.0-imagick
      - php8.0-imap
      - php8.0-intl
      - php8.0-ldap
      - php8.0-mbstring
      - php8.0-mysql
      - php8.0-opcache
      - php8.0-readline
      - php8.0-sqlite3
      - php8.0-soap
      - php8.0-uploadprogress
      - php8.0-xml
      - php8.0-xmlrpc
      - php8.0-xsl
      - php8.0-zip
      - php-pear
  - name: PHP 7.4 packages
    version: "7.4"
    state: present
    pkg_absent:
      - libapache2-mod-php7.4
      - php7.4-phpdbg
    pkg_present:
      - php7.4-apcu
      - php7.4-bcmath
      - php7.4-bz2
      - php7.4-cli
      - php7.4-common
      - php7.4-curl
      - php7.4-gd
      - php7.4-gmp
      - php7.4-geoip
      - php7.4-fpm
      - php7.4-imagick
      - php7.4-imap
      - php7.4-intl
      - php7.4-json
      - php7.4-ldap
      - php7.4-mbstring
      - php7.4-mysql
      - php7.4-opcache
      - php7.4-sqlite3
      - php7.4-soap
      - php7.4-readline
      - php7.4-uploadprogress
      - php7.4-xml
      - php7.4-xmlrpc
      - php7.4-xsl
      - php7.4-zip
      - php-pear
  # - name: PHP 7.3 packages
  #   version: "7.3"
  #   state: present
  #   pkg_present:
  #     - php7.3-bcmath
  #     - php7.3-bz2
  #     - php7.3-cli
  #     - php7.3-common
  #     - php7.3-curl
  #     - php7.3-fpm
  #     - php7.3-gd
  #     - php7.3-imap
  #     - php7.3-intl
  #     - php7.3-json
  #     - php7.3-ldap
  #     - php7.3-mbstring
  #     - php7.3-mysql
  #     - php7.3-opcache
  #     - php7.3-readline
  #     - php7.3-soap
  #     - php7.3-sqlite3
  #     - php7.3-tidy
  #     - php7.3-xml
  #     - php7.3-xmlrpc
  #     - php7.3-xsl
  #     - php7.3-zip
  # - name: PHP 7.0 packages
  #   version: "7.0"
  #   state: present
  #   pkg_present:
  #     - php7.0
  #     - php7.0-bcmath
  #     - php7.0-bz2
  #     - php7.0-cli
  #     - php7.0-common
  #     - php7.0-curl
  #     - php7.0-gd
  #     - php7.0-imap
  #     - php7.0-intl
  #     - php7.0-json
  #     - php7.0-mbstring
  #     - php7.0-mcrypt
  #     - php7.0-mysql
  #     - php7.0-opcache
  #     - php7.0-readline
  #     - php7.0-sqlite3
  #     - php7.0-xml
  #     - php7.0-xmlrpc
  #     - php7.0-zip
...
